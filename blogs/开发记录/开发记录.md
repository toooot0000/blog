# 开发记录

---

记录下这个Blog到底是咋弄出来的。

---

总之在吭哧吭哧搞了大概一个月总算是搞定了这个Blog。中间查了无数的文档踩了无数的坑，还有“以为自己做完了结果上手机一看全乱了”的糟心经历。但是——

> 踩坑是学习的必然过程。
>
> By 我自己

在这种精神的激励之下，直面了各种不可名状的bug，最后姑且算是完成了这个破网页，后续优化什么的，随缘了。

详细代码可以直接看仓库。整个项目概括来说，是用`vue.js`写模板，接着用自带的build工具输出，然后通过`manage.py`把md文件渲染进模板形成静态网页，最后再同步到github上就ok啦，轻松愉快。

实际上`vue`自带有Server-side rendering，不过出于几个原因我最后还是没有用。一个是因为我py脚本差不多写完了才看到这个功能，一个是因为它主要是面向`Node.js`的服务器的，学习Node又需要时间成本，而且在github page上（好像？）比较难实现。所以就最后还是使用了现在这个笨办法。

这里记录一些过程，作为开发总结。

### `vue-cli`生成的脚手架配置修改

`vue-cli`自己生成的脚手架里面，配置主要集中于`vue.config.js`这个文件中。[参考官方指南](https://cli.vuejs.org/zh/config)根据需求，需要修改的内容包括：

1. 输出路径 `outputDir`

   它自带的输出路径是在`(project folder)/dist`里面，而github page要求页面要么处于根目录要么处于`./docs`目录下。因此，这里把build路径配置成`./docs`

2. 公共资源路径 `publicPath`

   CLI默认的build出来的内容是会被部署在一个服务器的根目录里面，所以build出来的html里面共用资源的路径都是绝对目录。参考指南，根据具体环境配置不同的路径。

3. 输出多页面 `pages`

   CLI生成的模板项目是一个标准的单页应用，配合`vue-route`就可以完成大部分业务逻辑。现在想了一下，其实应该是可以利用`vue-router`动态配置路由，让前端读取并渲染md文件，实现展示博客的业务需求的（新目标get）。不过还是暂先撇开`vue-router`，以后再说。博客需要至少有一个主页和一个博客内容的展示页面。这样必然就需要输出两个页面，也就是需要在`vue.config.js`里面配置上`pages`属性。

4. 配置别名

   按照官方指南的`chainWebpack`方式配置就行。

5. 配置研发服务器`devServer`

   webpack自带有[研发服务器](https://webpack.js.org/configuration/dev-server/)，因为上面讲的工作流程的关系，使用默认设置（即`/dist`目录）是无法测试单个博客页面的，所以需要把`devServer.contentBase`修改到`/docs`匹配py脚本差值之后的博客网页。

### 页面的动画效果相关

背景的星空效果是从网上找的，自己调整了一下个别参数。第一屏的动画动画效果是使用的[`gsap`](https://greensock.com/gsap/)。使用上感觉还是不错的，各种接口都很方便。不过在手机上动画的定位出现了很严重的问题，整个动画会向画面的左上角飞过去。

后来发现应该是相对定位和`resize`的问题。手机上页面滚动的时候，下方的导航条会隐去，从而会触发`resize`事件，而`gsap`可能对于`resize`的计算并没有足够及时，所以导致动画仍然是以未改变大小前的位置定位的。

明白起因了那解决方案也就有了。因为只有手机端出现问题，所以把手机端的情况单独处理下就行，PC端不动。这个使用[别人写好的](http://detectmobilebrowsers.com/)就行。知道如何判断手机端了，接下来只需要把动画内的定位改成绝对定位就行了。

### py脚本插值

看看引入了那些库就知道都干了啥了。

```python
# cli工具。不过这个库封装的不太好，error throw有些问题，虽然有可能是我没仔细看文档，不过还是不推荐
import cli.app
# 读取.json文件配置
import json
# 差值判断，我用的patern是[[(content)]]
import re
# 读取.md，并转换成html
import markdown2
# 处理路径
from pathlib import Path
# 处理.md文件目录下的图片文件
from shutil import copy
# 懂得都懂
from time import gmtime, strftime
```

现在这一个脚本写了250行多，很难受，后续有机会拆分一下。

### 顺手写的.sh

每次修改博客之后都要一步一步手动走流程实在太麻烦了。最后受不了了写了个`.sh`，没啥技术含量。







